!function(e,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(e="undefined"!=typeof globalThis?globalThis:e||self).AppExtensionsSDK=i()}(this,(function(){"use strict";function e(e,i,t,n){return new(t||(t=Promise))((function(o,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function r(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(a,r)}d((n=n.apply(e,i||[])).next())}))}var i,t,n,o,s,a,r,d,c,l;"function"==typeof SuppressedError&&SuppressedError,function(e){e.SHOW_SNACKBAR="show_snackbar",e.SHOW_CONFIRMATION="show_confirmation",e.RESIZE="resize",e.INITIALIZE="initialize",e.OPEN_MODAL="open_modal",e.CLOSE_MODAL="close_modal",e.GET_SIGNED_TOKEN="get_signed_token",e.REDIRECT_TO="redirect_to",e.SHOW_FLOATING_WINDOW="show_floating_window",e.HIDE_FLOATING_WINDOW="hide_floating_window",e.SET_NOTIFICATION="set_notification",e.SET_FOCUS_MODE="set_focus_mode"}(i||(i={})),function(e){e.VISIBILITY="visibility",e.CLOSE_CUSTOM_MODAL="close_custom_modal",e.PAGE_VISIBILITY_STATE="page_visibility_state",e.USER_SETTINGS_CHANGE="user_settings_change"}(t||(t={})),function(e){e.COMMAND="command",e.LISTENER="listener",e.TRACK="track"}(n||(n={})),function(e){e.PRIMARY="primary",e.SECONDARY="secondary",e.NEGATIVE="negative"}(o||(o={})),function(e){e.DEAL="deal",e.ORGANIZATION="organization",e.PERSON="person",e.ACTIVITY="activity",e.JSON_MODAL="json_modal",e.CUSTOM_MODAL="custom_modal"}(s||(s={})),function(e){e.CLOSED="closed",e.SUBMITTED="submitted"}(a||(a={})),function(e){e.FOCUSED="focused"}(r||(r={})),function(e){e.USER="user",e.COMMAND="command"}(d||(d={})),function(e){e.DARK="dark",e.LIGHT="light"}(c||(c={})),function(e){e.DEALS="deals",e.LEADS="leads",e.ORGANIZATIONS="organizations",e.CONTACTS="contacts",e.CAMPAIGNS="campaigns",e.PROJECTS="projects",e.SETTINGS="settings"}(l||(l={}));const u=Object.values(i),E=Object.values(t);return Object.assign(class{constructor(e={}){const{identifier:i,targetWindow:t}=e;if(this.initialized=!1,this.window=null!=t?t:window.parent,this.identifier=null!=i?i:new URLSearchParams(window.location.search).get("id"),this.userSettings={theme:new URLSearchParams(window.location.search).get("theme")===c.DARK?c.DARK:c.LIGHT},!this.identifier)throw new Error("Missing custom UI identifier");!function(e){let i=!1;null===window||void 0===window||window.addEventListener("focus",(()=>{i||e(),i=!0})),null===window||void 0===window||window.addEventListener("blur",(()=>{i=!1}))}((()=>{this.track(r.FOCUSED)}))}postMessage(e,i="*"){return new Promise(((t,n)=>{const o=new MessageChannel,s={payload:e,id:this.identifier};o.port1.onmessage=({data:e})=>{o.port1.close();const{error:i,data:s}=e;i?n(new Error(i)):t(s)},this.window.postMessage(s,i,[o.port2])}))}execute(e,...i){if(!this.initialized)throw new Error("SDK is not initialized");if(!u.includes(e))throw new Error("Invalid command");return this.postMessage({command:e,args:i[0],type:n.COMMAND})}track(e,i="*"){const t={payload:{type:n.TRACK,event:e},id:this.identifier};this.window.postMessage(t,i)}onPageVisibilityChange(e){const i=()=>{e({data:{state:document.visibilityState}})};return document.addEventListener("visibilitychange",i),()=>document.removeEventListener("visibilitychange",i)}listen(e,i){if(!E.includes(e))throw new Error("Invalid event");if(e===t.PAGE_VISIBILITY_STATE)return this.onPageVisibilityChange(i);const o=new MessageChannel,s={payload:{type:n.LISTENER,event:e},id:this.identifier};return o.port1.onmessage=({data:n})=>{n.error&&o.port1.close(),i(n),e===t.USER_SETTINGS_CHANGE&&n&&(this.userSettings=n)},this.window.postMessage(s,"*",[o.port2]),()=>{o.port1.close()}}setWindow(e){this.window=e}initialize(t={}){return e(this,void 0,void 0,(function*(){return yield this.postMessage({command:i.INITIALIZE,args:t,type:n.COMMAND}),this.initialized=!0,this}))}},{Command:i,Event:t,Modal:s,ModalStatus:a,Color:o,TrackingEvent:r,MessageType:n,View:l,VisibilityEventInvoker:d})}));
//# sourceMappingURL=index.umd.js.map
